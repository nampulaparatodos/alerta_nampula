<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ cfg.nome }} ‚Äî {{ cfg.subtitulo }}</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=DM+Serif+Display:ital@0;1&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
/* ===== DESIGN TOKENS ===== */
:root {
  /* Core palette */
  --ink: #0a0f1e;
  --ink2: #111827;
  --ink3: #1a2438;
  --surface: #141d2f;
  --surface2: #1c2840;
  --surface3: #233050;
  --line: rgba(255,255,255,.07);
  --line2: rgba(255,255,255,.12);

  /* Brand */
  --primary: #1e56d9;
  --primary-light: #3b72f5;
  --primary-glow: rgba(30,86,217,.3);
  --accent: #00c9b1;
  --accent-glow: rgba(0,201,177,.2);

  /* Semantic */
  --danger: #e63946;
  --warning: #f4a017;
  --info: #3b82f6;
  --success: #0ea574;

  /* Text */
  --t1: #f0f6ff;
  --t2: #94aec8;
  --t3: #546884;

  /* Typography */
  --font-ui: 'Sora', sans-serif;
  --font-display: 'DM Serif Display', serif;
  --font-mono: 'JetBrains Mono', monospace;

  /* Spacing & radius */
  --r-sm: 8px;
  --r-md: 14px;
  --r-lg: 20px;
  --r-xl: 28px;

  /* Transitions */
  --t-fast: .15s ease;
  --t-mid: .25s ease;
  --t-slow: .4s cubic-bezier(.23,1,.32,1);
}

/* ===== RESET ===== */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; font-size: 16px; }
body {
  font-family: var(--font-ui);
  background: var(--ink);
  color: var(--t1);
  overflow-x: hidden;
  line-height: 1.65;
  min-height: 100vh;
}

/* Atmospheric bg */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0;
  background:
    radial-gradient(ellipse 100% 70% at 5% 0%, rgba(30,86,217,.18) 0%, transparent 55%),
    radial-gradient(ellipse 70% 50% at 95% 100%, rgba(0,201,177,.1) 0%, transparent 50%),
    radial-gradient(ellipse 50% 40% at 50% 30%, rgba(30,86,217,.06) 0%, transparent 60%);
  pointer-events: none;
}
body > * { position: relative; z-index: 1; }

/* Grid texture */
body::after {
  content: '';
  position: fixed; inset: 0; z-index: 0;
  background-image:
    linear-gradient(rgba(255,255,255,.015) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,.015) 1px, transparent 1px);
  background-size: 48px 48px;
  pointer-events: none;
}

/* ===== SCROLLBAR ===== */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--ink2); }
::-webkit-scrollbar-thumb { background: var(--surface3); border-radius: 99px; }

/* ===== UTILITY ===== */
.container { max-width: 1240px; margin: 0 auto; padding: 0 24px; width: 100%; }
.visually-hidden { position: absolute; width: 1px; height: 1px; overflow: hidden; clip: rect(0,0,0,0); }

/* ===== HEADER ===== */
header {
  position: fixed; top: 0; left: 0; right: 0; z-index: 900;
  transition: background var(--t-mid), border-color var(--t-mid), backdrop-filter var(--t-mid);
  border-bottom: 1px solid transparent;
}
header.scrolled {
  background: rgba(10,15,30,.92);
  backdrop-filter: blur(24px) saturate(1.5);
  -webkit-backdrop-filter: blur(24px) saturate(1.5);
  border-bottom-color: var(--line);
}
.hdr {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 0 24px;
  height: 68px;
  max-width: 1240px;
  margin: 0 auto;
}

/* Logo */
.logo {
  display: flex; align-items: center; gap: 12px;
  text-decoration: none; flex-shrink: 0;
}
.logo-mark {
  width: 44px; height: 44px; flex-shrink: 0;
  background: linear-gradient(135deg, var(--primary), var(--accent));
  border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.2rem; color: #fff; font-weight: 800;
  box-shadow: 0 0 24px var(--primary-glow);
  position: relative;
  overflow: hidden;
}
.logo-mark::after {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,.15), transparent);
}
.logo-mark svg { width: 24px; height: 24px; fill: white; position: relative; z-index: 1; }
.logo-text { display: flex; flex-direction: column; }
.logo-name {
  font-family: var(--font-display);
  font-size: 1.15rem;
  color: var(--t1);
  line-height: 1.1;
  letter-spacing: -.2px;
}
.logo-sub {
  font-size: .65rem;
  color: var(--t3);
  text-transform: uppercase;
  letter-spacing: 1.2px;
  margin-top: 2px;
}

/* Nav */
nav { display: flex; align-items: center; gap: 4px; margin-left: auto; }
nav a {
  display: flex; align-items: center; gap: 7px;
  color: var(--t2); font-size: .85rem; font-weight: 500;
  padding: 8px 14px; border-radius: var(--r-md);
  text-decoration: none; transition: color var(--t-fast), background var(--t-fast);
  white-space: nowrap;
}
nav a:hover { color: var(--t1); background: var(--surface); }

/* Accessibility nav item */
.nav-acc-trigger {
  display: flex; align-items: center; gap: 7px;
  color: var(--t2); font-size: .85rem; font-weight: 500;
  padding: 8px 14px; border-radius: var(--r-md);
  cursor: pointer; position: relative;
  border: none; background: none; font-family: var(--font-ui);
  transition: color var(--t-fast), background var(--t-fast);
  white-space: nowrap;
}
.nav-acc-trigger:hover { color: var(--t1); background: var(--surface); }
.acc-dropdown {
  position: absolute; top: calc(100% + 8px); right: 0;
  background: var(--surface);
  border: 1px solid var(--line2);
  border-radius: var(--r-lg);
  padding: 10px;
  min-width: 220px;
  box-shadow: 0 20px 60px rgba(0,0,0,.5);
  display: none; flex-direction: column; gap: 4px;
  z-index: 99;
}
.acc-dropdown.open { display: flex; }
.acc-item {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 14px; border-radius: var(--r-sm);
  font-size: .84rem; font-weight: 500; color: var(--t2);
  cursor: pointer; border: none; background: none;
  font-family: var(--font-ui); text-align: left;
  transition: color var(--t-fast), background var(--t-fast);
  width: 100%;
}
.acc-item i { width: 16px; color: var(--accent); }
.acc-item:hover, .acc-item.on { color: var(--t1); background: var(--surface2); }
.acc-item.on i { color: var(--primary-light); }

/* Header actions */
.hdr-actions { display: flex; align-items: center; gap: 10px; flex-shrink: 0; margin-left: auto; }

/* Buttons - VERS√ÉO REDUZIDA */
.btn {
  display: inline-flex; align-items: center; gap: 6px; /* ‚Üê gap reduzido */
  padding: 7px 16px; /* ‚Üê padding reduzido (antes 9px 20px) */
  border-radius: var(--r-md);
  font-size: .8rem; /* ‚Üê fonte reduzida (antes .84rem) */
  font-weight: 600;
  cursor: pointer; border: none;
  transition: transform var(--t-fast), box-shadow var(--t-fast), background var(--t-fast);
  font-family: var(--font-ui); text-decoration: none;
  white-space: nowrap; letter-spacing: .1px;
}

.btn-primary {
  background: var(--primary);
  color: #fff;
  box-shadow: 0 3px 12px var(--primary-glow); /* ‚Üê sombra ligeiramente menor */
}

.btn-primary:hover {
  background: var(--primary-light);
  transform: translateY(-1px);
  box-shadow: 0 6px 18px var(--primary-glow); /* ‚Üê sombra hover reduzida */
  color: #fff;
}

.btn-ghost {
  background: var(--surface);
  color: var(--t2);
  border: 1px solid var(--line2);
}

.btn-ghost:hover { background: var(--surface2); color: var(--t1); }

.btn-teal {
  background: var(--accent);
  color: var(--ink);
  font-weight: 700;
  box-shadow: 0 3px 12px var(--accent-glow); /* ‚Üê sombra reduzida */
}

.btn-teal:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 18px var(--accent-glow); /* ‚Üê sombra hover reduzida */
  color: var(--ink);
}
/* Hamburger ‚Äî hidden on desktop, shown on mobile via media query */
.ham {
  display: none;
  background: var(--surface); border: 1px solid var(--line2);
  border-radius: var(--r-sm); width: 40px; height: 40px;
  align-items: center; justify-content: center;
  color: var(--t1); font-size: 1rem; cursor: pointer;
  flex-shrink: 0; transition: background var(--t-fast);
}
.ham:hover { background: var(--surface2); }

/* Mobile nav overlay ‚Äî must be above header (z-index:900) */
.mobile-nav {
  display: none; position: fixed; inset: 0; z-index: 950;
  background: rgba(10,15,30,.98);
  backdrop-filter: blur(24px);
  flex-direction: column; align-items: center; justify-content: center;
  gap: 8px;
}
.mobile-nav.open { display: flex; }
.mobile-nav a, .mobile-nav .mob-nav-link {
  font-size: 1.2rem; font-weight: 600; color: var(--t2);
  padding: 14px 32px; border-radius: var(--r-md);
  text-decoration: none; transition: color var(--t-fast), background var(--t-fast);
  width: 240px; text-align: center; cursor: pointer;
  border: none; background: none; font-family: var(--font-ui);
}
.mobile-nav a:hover, .mobile-nav .mob-nav-link:hover { color: var(--t1); background: var(--surface); }

/* Mobile acc section in nav */
.mobile-acc-section {
  border-top: 1px solid var(--line); margin-top: 16px; padding-top: 16px;
  display: flex; flex-direction: column; gap: 6px; width: 240px;
}
.mobile-acc-title {
  font-size: .72rem; text-transform: uppercase; letter-spacing: 1.5px;
  color: var(--t3); font-weight: 600; padding: 0 8px; margin-bottom: 4px;
}
.mob-acc-btn {
  display: flex; align-items: center; gap: 10px;
  font-size: .9rem; font-weight: 500; color: var(--t2);
  padding: 10px 14px; border-radius: var(--r-md);
  cursor: pointer; border: none; background: none;
  font-family: var(--font-ui); text-align: left; width: 100%;
  transition: color var(--t-fast), background var(--t-fast);
}
.mob-acc-btn i { width: 18px; color: var(--accent); }
.mob-acc-btn:hover, .mob-acc-btn.on { color: var(--t1); background: var(--surface); }
.mobile-nav-close {
  position: absolute; top: 24px; right: 24px;
  background: var(--surface); border: 1px solid var(--line2);
  border-radius: var(--r-md); width: 40px; height: 40px;
  display: flex; align-items: center; justify-content: center;
  color: var(--t1); cursor: pointer; font-size: 1rem;
}

/* ===== TICKER ===== */
.ticker {
  margin-top: 68px;
  background: linear-gradient(90deg, var(--danger), #c1121f);
  overflow: hidden; position: relative;
}
.ticker::before, .ticker::after {
  content: ''; position: absolute; top: 0; bottom: 0; width: 64px; z-index: 2;
}
.ticker::before { left: 0; background: linear-gradient(90deg, var(--danger), transparent); }
.ticker::after { right: 0; background: linear-gradient(-90deg, #c1121f, transparent); }
.ticker-track {
  display: flex; width: max-content;
  animation: ticker-scroll 50s linear infinite;
}
.ticker-track:hover { animation-play-state: paused; }
.t-item {
  display: inline-flex; align-items: center; gap: 10px;
  padding: 10px 44px;
  font-size: .78rem; font-weight: 700; color: #fff; white-space: nowrap;
  font-family: var(--font-mono); letter-spacing: .5px;
}
.t-sep { width: 4px; height: 4px; background: rgba(255,255,255,.5); border-radius: 50%; flex-shrink: 0; }
@keyframes ticker-scroll { from { transform: translateX(0); } to { transform: translateX(-50%); } }

/* ===== HERO ===== */
.hero {
  min-height: calc(100vh - 68px);
  display: flex; align-items: center;
  padding: 40px 24px 80px;
}
.hero-inner {
  max-width: 1240px; margin: 0 auto; width: 100%;
  display: grid; grid-template-columns: 1fr 1fr; gap: 80px; align-items: center;
}
.hero-badge {
  display: inline-flex; align-items: center; gap: 8px;
  background: rgba(0,201,177,.08); border: 1px solid rgba(0,201,177,.2);
  color: var(--accent); padding: 6px 14px; border-radius: 99px;
  font-size: .72rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase;
  margin-bottom: 24px;
  animation: fadeUp .6s ease both;
}
.pulse-dot {
  width: 7px; height: 7px; border-radius: 50%; background: var(--accent);
  animation: pulse-ring 2s ease infinite;
  box-shadow: 0 0 0 0 var(--accent-glow);
}
@keyframes pulse-ring {
  0% { box-shadow: 0 0 0 0 var(--accent-glow); }
  70% { box-shadow: 0 0 0 8px transparent; }
  100% { box-shadow: 0 0 0 0 transparent; }
}
.hero h1 {
  font-family: var(--font-display);
  font-size: clamp(2.8rem, 5vw, 4.8rem);
  line-height: 1.05; letter-spacing: -1px;
  color: var(--t1); margin-bottom: 20px;
  animation: fadeUp .7s .1s ease both;
}
.hero h1 em {
  font-style: italic;
  background: linear-gradient(135deg, var(--primary-light), var(--accent));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text;
}
.hero-desc {
  font-size: 1rem; color: var(--t2); line-height: 1.85; max-width: 480px;
  margin-bottom: 36px;
  animation: fadeUp .7s .2s ease both;
}
.hero-cta { display: flex; gap: 12px; flex-wrap: wrap; animation: fadeUp .7s .3s ease both; }

/* Dashboard card */
.hero-card {
  background: var(--surface);
  border: 1px solid var(--line2);
  border-radius: var(--r-xl);
  padding: 28px;
  box-shadow: 0 40px 80px rgba(0,0,0,.4), 0 0 0 1px rgba(255,255,255,.03) inset;
  animation: fadeUp .8s .2s ease both;
}
.hc-label {
  font-size: .68rem; text-transform: uppercase; letter-spacing: 1.5px;
  color: var(--t3); font-weight: 700; margin-bottom: 20px;
  display: flex; align-items: center; gap: 10px;
}
.hc-label::after { content: ''; flex: 1; height: 1px; background: var(--line); }
.hc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 14px; }
.hc-metric {
  background: var(--surface2); border: 1px solid var(--line);
  border-radius: var(--r-md); padding: 16px;
  transition: border-color var(--t-mid), background var(--t-mid);
}
.hc-metric:hover { border-color: var(--line2); background: var(--surface3); }
.hc-icon { font-size: .85rem; margin-bottom: 10px; }
.hc-num {
  font-family: var(--font-mono);
  font-size: 1.9rem; font-weight: 600; color: var(--t1); line-height: 1;
}
.hc-txt { font-size: .72rem; color: var(--t3); margin-top: 4px; }
.hc-status {
  background: var(--surface2); border: 1px solid var(--line);
  border-radius: var(--r-md); padding: 14px 16px;
  display: flex; align-items: center; gap: 12px;
}
.hc-status-ico {
  width: 34px; height: 34px; border-radius: 9px;
  background: rgba(0,201,177,.1); border: 1px solid rgba(0,201,177,.2);
  display: flex; align-items: center; justify-content: center;
  color: var(--accent); font-size: .85rem; flex-shrink: 0;
}
.hc-status-label { font-size: .75rem; color: var(--t3); }
.hc-status-val { font-size: .9rem; font-weight: 700; color: var(--t1); }
.status-pill {
  margin-left: auto; background: rgba(14,165,116,.1);
  border: 1px solid rgba(14,165,116,.2); color: var(--success);
  padding: 3px 10px; border-radius: 99px; font-size: .68rem; font-weight: 700;
  white-space: nowrap; font-family: var(--font-mono);
}

@keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

/* ===== STATS BAR ===== */
.stats-bar {
  background: var(--surface);
  border-top: 1px solid var(--line);
  border-bottom: 1px solid var(--line);
}
.stats-inner {
  max-width: 1240px; margin: 0 auto; padding: 0 24px;
  display: grid; grid-template-columns: repeat(4, 1fr);
}
.stat-item {
  padding: 36px 24px; text-align: center;
  border-right: 1px solid var(--line);
  transition: background var(--t-mid);
}
.stat-item:last-child { border-right: none; }
.stat-item:hover { background: var(--surface2); }
.stat-num {
  font-family: var(--font-mono);
  font-size: 2.8rem; font-weight: 600; color: var(--t1); line-height: 1;
  margin-bottom: 6px;
}
.stat-label {
  font-size: .72rem; text-transform: uppercase; letter-spacing: 1px;
  color: var(--t3); font-weight: 600;
}

/* ===== SECTION WRAPPER ===== */
.section { padding: 96px 24px; }
.section-inner { max-width: 1240px; margin: 0 auto; }
.section-head { margin-bottom: 56px; }
.sec-chip {
  display: inline-flex; align-items: center; gap: 8px;
  background: rgba(30,86,217,.1); border: 1px solid rgba(30,86,217,.2);
  color: var(--primary-light); padding: 5px 14px; border-radius: 99px;
  font-size: .7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
  margin-bottom: 14px;
}
.sec-title {
  font-family: var(--font-display);
  font-size: clamp(1.9rem, 4vw, 3rem);
  color: var(--t1); line-height: 1.1; letter-spacing: -.5px;
  margin-bottom: 12px;
}
.sec-desc { font-size: .95rem; color: var(--t2); line-height: 1.85; max-width: 520px; }

/* ===== ALERTS ===== */
.alerts-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 20px; }
.alert-card {
  background: var(--surface); border: 1px solid var(--line);
  border-radius: var(--r-xl); padding: 28px;
  position: relative; overflow: hidden;
  transition: transform var(--t-slow), border-color var(--t-mid), box-shadow var(--t-mid);
}
.alert-card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
  border-radius: var(--r-xl) var(--r-xl) 0 0;
}
.alert-card.urgente::before { background: linear-gradient(90deg, var(--danger), #f4582c); }
.alert-card.atencao::before { background: linear-gradient(90deg, var(--warning), #f59e0b); }
.alert-card.informativo::before { background: linear-gradient(90deg, var(--info), var(--accent)); }
.alert-card:hover {
  transform: translateY(-6px);
  border-color: var(--line2);
  box-shadow: 0 20px 50px rgba(0,0,0,.35);
}
.alert-card.urgente { animation: urgent-pulse 4s ease infinite; }
@keyframes urgent-pulse {
  0%, 100% { box-shadow: 0 0 0 rgba(230,57,70,0); }
  50% { box-shadow: 0 0 32px rgba(230,57,70,.12); }
}
.alert-badge {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 4px 12px; border-radius: 99px;
  font-size: .68rem; font-weight: 800; text-transform: uppercase; letter-spacing: .8px;
  margin-bottom: 16px;
}
.badge-urgente { background: rgba(230,57,70,.1); color: #f87171; border: 1px solid rgba(230,57,70,.2); }
.badge-atencao { background: rgba(244,160,23,.1); color: #fbbf24; border: 1px solid rgba(244,160,23,.2); }
.badge-informativo { background: rgba(59,130,246,.1); color: #93c5fd; border: 1px solid rgba(59,130,246,.2); }
.alert-title { font-size: 1.05rem; font-weight: 700; color: var(--t1); margin-bottom: 8px; line-height: 1.35; }
.alert-date { display: flex; align-items: center; gap: 6px; font-size: .74rem; color: var(--t3); margin-bottom: 12px; font-family: var(--font-mono); }
.alert-text { font-size: .88rem; color: var(--t2); line-height: 1.75; }

/* ===== COMPONENTS GRID ===== */
.comp-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
.comp-card {
  background: var(--surface); border: 1px solid var(--line);
  border-radius: var(--r-lg); padding: 30px 24px;
  text-align: center; position: relative; overflow: hidden;
  transition: transform var(--t-slow), border-color var(--t-mid);
}
.comp-card:hover { transform: translateY(-5px); border-color: var(--line2); }
.comp-ico {
  width: 64px; height: 64px; border-radius: 18px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.6rem; margin: 0 auto 20px;
}
.ico-b { background: rgba(30,86,217,.12); color: var(--primary-light); border: 1px solid rgba(30,86,217,.2); }
.ico-r { background: rgba(230,57,70,.1); color: #f87171; border: 1px solid rgba(230,57,70,.15); }
.ico-g { background: rgba(14,165,116,.1); color: var(--success); border: 1px solid rgba(14,165,116,.15); }
.ico-a { background: rgba(244,160,23,.1); color: var(--warning); border: 1px solid rgba(244,160,23,.15); }
.comp-title { font-size: .95rem; font-weight: 700; color: var(--t1); margin-bottom: 8px; }
.comp-desc { font-size: .83rem; color: var(--t2); line-height: 1.7; }

/* ===== APOIO LAYOUT ===== */
.apoio-layout { display: grid; grid-template-columns: 1fr 1fr 1.2fr; gap: 20px; }
.apoio-panel {
  background: var(--surface); border: 1px solid var(--line);
  border-radius: var(--r-xl); padding: 26px; overflow: hidden;
}
.panel-header {
  display: flex; align-items: center; gap: 14px;
  padding-bottom: 18px; margin-bottom: 18px;
  border-bottom: 1px solid var(--line);
}
.panel-ico {
  width: 44px; height: 44px; border-radius: 12px; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center; font-size: 1.05rem;
}
.pi-blue { background: rgba(30,86,217,.12); color: var(--primary-light); border: 1px solid rgba(30,86,217,.2); }
.pi-green { background: rgba(14,165,116,.1); color: var(--success); border: 1px solid rgba(14,165,116,.15); }
.pi-red { background: rgba(230,57,70,.1); color: #f87171; border: 1px solid rgba(230,57,70,.15); }
.panel-header h3 { font-size: .98rem; font-weight: 700; color: var(--t1); }
.panel-count { font-size: .74rem; color: var(--t3); margin-top: 2px; }

.fam-row { padding: 14px 0; border-bottom: 1px solid var(--line); }
.fam-row:last-child { border-bottom: none; padding-bottom: 0; }
.fam-row h4 { font-size: .9rem; font-weight: 700; color: var(--t1); margin-bottom: 8px; }
.fam-row p { font-size: .81rem; color: var(--t2); display: flex; align-items: flex-start; gap: 8px; margin: 4px 0; line-height: 1.5; }
.fam-row p i { color: var(--primary-light); margin-top: 2px; flex-shrink: 0; width: 14px; }

.zona-row { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--line); }
.zona-row:last-child { border-bottom: none; padding-bottom: 0; }
.zona-name { font-size: .88rem; font-weight: 700; color: var(--t1); }
.zona-res { font-size: .74rem; color: var(--t3); margin-top: 2px; }
.zona-cap {
  margin-left: auto; flex-shrink: 0;
  background: rgba(14,165,116,.08); border: 1px solid rgba(14,165,116,.15);
  color: var(--success); padding: 3px 10px; border-radius: 99px;
  font-size: .72rem; font-weight: 700; white-space: nowrap; font-family: var(--font-mono);
}

/* Form */
.form-grid { display: flex; flex-direction: column; gap: 14px; }
.fg { display: flex; flex-direction: column; gap: 6px; }
.fl { font-size: .68rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; color: var(--t3); }
.fi {
  width: 100%; padding: 11px 14px;
  background: var(--surface2); border: 1px solid var(--line);
  border-radius: var(--r-sm); color: var(--t1);
  font-size: .88rem; font-family: var(--font-ui);
  transition: border-color var(--t-fast), background var(--t-fast), box-shadow var(--t-fast);
  -webkit-appearance: none; appearance: none;
}
.fi:focus { outline: none; border-color: var(--primary); background: var(--surface3); box-shadow: 0 0 0 3px var(--primary-glow); }
.fi::placeholder { color: var(--t3); }
select.fi { cursor: pointer; }
select.fi option { background: var(--surface2); color: var(--t1); }
.btn-full { width: 100%; justify-content: center; padding: 13px; font-size: .9rem; }
.form-ok {
  display: none; background: rgba(14,165,116,.08); border: 1px solid rgba(14,165,116,.2);
  color: var(--success); padding: 12px 16px; border-radius: var(--r-md);
  font-size: .85rem; gap: 8px; align-items: center;
}
.form-ok.show { display: flex; }
.form-err {
  display: none; background: rgba(230,57,70,.08); border: 1px solid rgba(230,57,70,.2);
  color: #f87171; padding: 12px 16px; border-radius: var(--r-md);
  font-size: .85rem; gap: 8px; align-items: center;
}
.form-err.show { display: flex; }

/* ===== NOTIFICATIONS ===== */
.notif-layout { display: grid; grid-template-columns: 1fr 1.4fr; gap: 60px; align-items: start; }
.notif-features { display: flex; flex-direction: column; gap: 20px; margin-top: 36px; }
.nf-row { display: flex; align-items: flex-start; gap: 14px; }
.nf-ico { width: 42px; height: 42px; border-radius: 11px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: .95rem; }
.nf-wpp { background: rgba(37,211,102,.08); color: #25d366; border: 1px solid rgba(37,211,102,.15); }
.nf-sms { background: rgba(0,201,177,.08); color: var(--accent); border: 1px solid rgba(0,201,177,.15); }
.nf-ussd { background: rgba(244,160,23,.08); color: var(--warning); border: 1px solid rgba(244,160,23,.15); }
.nf-free { background: rgba(14,165,116,.08); color: var(--success); border: 1px solid rgba(14,165,116,.15); }
.nf-text h4 { font-size: .9rem; font-weight: 700; color: var(--t1); margin-bottom: 2px; }
.nf-text p { font-size: .82rem; color: var(--t2); line-height: 1.6; }

/* Notif card */
.notif-card {
  background: var(--surface); border: 1px solid var(--line);
  border-radius: var(--r-xl); padding: 34px;
  box-shadow: 0 40px 80px rgba(0,0,0,.3);
  position: relative; overflow: hidden;
}
.notif-card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
  background: linear-gradient(90deg, var(--primary), var(--accent));
}
.notif-card-title { font-size: 1.2rem; font-weight: 700; color: var(--t1); margin-bottom: 4px; }
.notif-card-sub { font-size: .84rem; color: var(--t2); margin-bottom: 26px; }

/* Channel pills */
.channel-row { display: flex; flex-wrap: wrap; gap: 10px; }
.channel-pill {
  display: flex; align-items: center; gap: 8px; padding: 9px 16px;
  background: var(--surface2); border: 1.5px solid var(--line);
  border-radius: var(--r-md); cursor: pointer; font-size: .83rem; font-weight: 600;
  color: var(--t2); transition: all var(--t-fast); user-select: none;
  font-family: var(--font-ui);
}
.channel-pill input { display: none; }
.channel-pill:hover { background: var(--surface3); border-color: var(--line2); color: var(--t1); }
.channel-pill:has(input:checked) { color: var(--t1); border-color: transparent; }
.channel-pill.wpp:has(input:checked) { background: rgba(37,211,102,.1); border-color: rgba(37,211,102,.25); color: #25d366; }
.channel-pill.sms:has(input:checked) { background: rgba(0,201,177,.08); border-color: rgba(0,201,177,.2); color: var(--accent); }
.channel-pill.ussd:has(input:checked) { background: rgba(244,160,23,.08); border-color: rgba(244,160,23,.2); color: var(--warning); }

/* Alert type chips */
.alert-chips { display: flex; flex-wrap: wrap; gap: 8px; }
.alert-chip {
  display: flex; align-items: center; gap: 6px; padding: 7px 14px;
  background: var(--surface2); border: 1.5px solid var(--line);
  border-radius: var(--r-sm); cursor: pointer; font-size: .78rem; font-weight: 600;
  color: var(--t2); transition: all var(--t-fast); user-select: none;
  font-family: var(--font-ui);
}
.alert-chip input { display: none; }
.alert-chip:hover { background: var(--surface3); border-color: var(--line2); color: var(--t1); }
.alert-chip:has(input:checked) { background: rgba(30,86,217,.1); border-color: rgba(30,86,217,.25); color: #93c5fd; }

/* USSD banner */
.ussd-banner {
  background: rgba(30,86,217,.06); border: 1px solid rgba(30,86,217,.15);
  border-radius: var(--r-md); padding: 16px 20px;
  display: flex; align-items: center; gap: 16px; margin-top: 20px;
}
.ussd-code { font-family: var(--font-mono); font-size: 1.5rem; font-weight: 600; color: var(--accent); white-space: nowrap; letter-spacing: 1px; }
.ussd-banner p { font-size: .8rem; color: var(--t2); line-height: 1.5; }
.ussd-banner strong { color: var(--t1); }

/* Consent row */
.consent-row { display: flex; align-items: flex-start; gap: 10px; cursor: pointer; font-size: .82rem; color: var(--t2); }
.consent-row input { margin-top: 2px; accent-color: var(--primary); flex-shrink: 0; }
.double-col { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }

/* ===== FOOTER ===== */
footer {
  background: var(--ink2);
  border-top: 1px solid var(--line);
  padding: 72px 24px 32px;
}
.foot-inner { max-width: 1240px; margin: 0 auto; }
.foot-grid { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 48px; margin-bottom: 48px; }
.foot-brand-desc { font-size: .84rem; color: var(--t3); line-height: 1.85; max-width: 280px; margin: 16px 0 20px; }
.socials { display: flex; gap: 8px; }
.soc-btn {
  width: 38px; height: 38px; border-radius: 10px;
  background: var(--surface); border: 1px solid var(--line);
  display: flex; align-items: center; justify-content: center;
  color: var(--t3); text-decoration: none;
  transition: background var(--t-fast), color var(--t-fast), border-color var(--t-fast), transform var(--t-fast);
}
.soc-btn:hover { background: var(--primary); border-color: var(--primary); color: #fff; transform: translateY(-2px); }
.foot-col h4 {
  font-size: .68rem; text-transform: uppercase; letter-spacing: 1.5px;
  color: var(--t3); font-weight: 700; margin-bottom: 16px;
}
.foot-col ul { list-style: none; display: flex; flex-direction: column; gap: 10px; }
.foot-col a, .foot-col li { color: var(--t3); font-size: .84rem; text-decoration: none; display: flex; align-items: center; gap: 8px; transition: color var(--t-fast); }
.foot-col a:hover { color: var(--t1); }
.foot-col a i, .foot-col li i { width: 14px; color: var(--primary-light); font-size: .75rem; flex-shrink: 0; }
.foot-divider { height: 1px; background: var(--line); margin-bottom: 24px; }
.foot-bottom { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }
.foot-bottom p { font-size: .76rem; color: var(--t3); }
.foot-verified {
  display: inline-flex; align-items: center; gap: 7px;
  background: rgba(14,165,116,.07); border: 1px solid rgba(14,165,116,.15);
  color: var(--success); padding: 5px 12px; border-radius: 99px;
  font-size: .72rem; font-weight: 700;
}

/* Back to top */
.btt {
  position: fixed; bottom: 24px; right: 24px; z-index: 800;
  width: 44px; height: 44px; border-radius: var(--r-md);
  background: var(--primary); color: #fff;
  border: none; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  font-size: .9rem;
  box-shadow: 0 4px 16px var(--primary-glow);
  opacity: 0; visibility: hidden;
  transition: opacity var(--t-mid), visibility var(--t-mid), transform var(--t-fast);
}
.btt.show { opacity: 1; visibility: visible; }
.btt:hover { transform: translateY(-2px); }

/* ===== HIGH CONTRAST MODE ===== */
body.hc {
  --ink: #000; --ink2: #000; --ink3: #000;
  --surface: #111; --surface2: #1a1a1a; --surface3: #222;
  --line: rgba(255,255,0,.4); --line2: rgba(255,255,0,.5);
  --t1: #ffff00; --t2: #ffff00; --t3: #ffcc00;
  --primary: #ffff00; --primary-light: #fff176; --accent: #00ffff;
}
body.hc .hero h1, body.hc .sec-title { color: #ffff00; }
body.hc header.scrolled { background: #000; }

/* ===== LIGHT MODE ===== */
body.light-mode {
  --ink: #f0f5ff; --ink2: #e8eeff; --ink3: #dde5ff;
  --surface: #fff; --surface2: #f5f7ff; --surface3: #eef1ff;
  --line: rgba(0,30,100,.08); --line2: rgba(0,30,100,.12);
  --t1: #0f1f40; --t2: #3d5270; --t3: #7a90b0;
  --primary-glow: rgba(30,86,217,.15);
}
body.light-mode header.scrolled { background: rgba(240,245,255,.92); }
body.light-mode .hero h1, body.light-mode .sec-title { color: var(--t1); }
body.light-mode .stat-num { color: var(--t1); }
body.light-mode body::before { display: none; }
body.light-mode .hc-num { color: var(--t1); }

/* ===== EMPTY STATE ===== */
.empty-state { text-align: center; padding: 80px 20px; color: var(--t3); }
.empty-state i { font-size: 3rem; margin-bottom: 16px; display: block; opacity: .2; }
.empty-state p { font-size: 1rem; }

/* ===== TEXT OVERFLOW PREVENTION ===== */
/* Any text inside cards/panels must not escape its container */
.alert-card, .comp-card, .apoio-panel, .notif-card, .hero-card,
.fam-row, .zona-row, .hc-metric, .nf-text, .foot-col, .foot-brand-col {
  min-width: 0;
  word-break: break-word;
  overflow-wrap: break-word;
}
/* Cards need overflow:hidden so content never bleeds past border-radius */
.alert-card, .comp-card, .apoio-panel, .notif-card, .hero-card, .hc-metric {
  overflow: hidden;
}
.alert-title, .alert-text, .comp-desc, .comp-title,
.fam-row h4, .fam-row p, .zona-name, .zona-res,
.nf-text h4, .nf-text p,
.foot-brand-desc, .foot-col a, .foot-col li {
  overflow-wrap: break-word;
  word-break: break-word;
  min-width: 0;
}
/* Grid and flex children must respect container width */
.alerts-grid > *, .comp-grid > *, .apoio-layout > *,
.hc-grid > *, .stats-inner > *, .notif-layout > *,
.foot-grid > *, .nf-row {
  min-width: 0;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 1200px) {
  .comp-grid { grid-template-columns: 1fr 1fr; }
  .apoio-layout { grid-template-columns: 1fr 1fr; }
  .apoio-layout .apoio-panel:last-child { grid-column: 1 / -1; }
  .notif-layout { grid-template-columns: 1fr; gap: 40px; }
  .notif-features { flex-direction: row; flex-wrap: wrap; }
  .nf-row { flex: 1 1 200px; }
}
@media (max-width: 960px) {
  .hero-inner { grid-template-columns: 1fr; gap: 48px; }
  .hero-right { display: none; }
  .stats-inner { grid-template-columns: 1fr 1fr; }
  .stat-item:nth-child(2) { border-right: none; }
  .foot-grid { grid-template-columns: 1fr 1fr; gap: 32px; }
  /* Hide desktop nav, show ham */
  nav { display: none !important; }
  .ham { display: flex !important; }
  .hdr-actions .btn-ghost { display: none; }
  /* hdr-actions is already margin-left:auto so ham sits at far right */
  .hdr-actions .btn-primary { padding: 9px 14px; font-size: .8rem; }
}
@media (max-width: 720px) {
  .section { padding: 64px 0; }
  .section-inner { padding: 0 16px; }
  .hero { padding: 32px 16px 48px; min-height: unset; align-items: flex-start; }
  .hdr { padding: 0 16px; height: 60px; }
  /* Logo: hide subtitle on small screens to save space */
  .logo-sub { display: none; }
  /* Compact logo mark */
  .logo-mark { width: 36px; height: 36px; border-radius: 9px; }
  .logo-mark svg { width: 18px; height: 18px; }
  .logo-name { font-size: 1rem; }
  /* Compact action btn */
  .hdr-actions .btn-primary { padding: 8px 12px; font-size: .78rem; gap: 6px; }
  /* Ham always visible and prominent */
  .ham { display: flex !important; width: 36px; height: 36px; }

  /* Ticker: margin matches new header height */
  .ticker, div[style*="margin-top:68px"] { margin-top: 60px !important; }

  /* Sections */
  .alerts-grid { grid-template-columns: 1fr; }
  .comp-grid { grid-template-columns: 1fr; }
  .apoio-layout { grid-template-columns: 1fr; }
  .apoio-layout .apoio-panel:last-child { grid-column: auto; }
  .stats-inner { padding: 0 16px; }
  .stat-num { font-size: 1.9rem; }
  .stat-item { padding: 22px 12px; }
  .double-col { grid-template-columns: 1fr; }
  .foot-grid { grid-template-columns: 1fr; gap: 24px; }
  .foot-col:not(.foot-brand-col) { display: none; }
  footer { padding: 48px 16px 28px; }
  .notif-card { padding: 20px 16px; }
  .apoio-panel { padding: 18px 16px; }
  .alert-card { padding: 20px 16px; }
  .hero h1 { font-size: 2.4rem; letter-spacing: -.5px; }
  .hero-desc { max-width: 100%; }
  .channel-row { flex-direction: column; }
  .alert-chips { gap: 6px; }
  .ussd-banner { flex-direction: column; gap: 10px; align-items: flex-start; }
  .notif-features { flex-direction: column; }
  .nf-row { flex: unset; }
  /* Panel header: wrap if needed */
  .panel-header { flex-wrap: wrap; }
  .fam-row p { word-break: break-word; }

  /* === CENTRALIZA√á√ÉO DOS BOT√ïES DE ACESSIBILIDADE NO MOBILE === */
  .mobile-acc-section {
    align-items: center;  /* centraliza os itens filhos (bot√µes) */
  }
  .mob-acc-btn {
    justify-content: center;  /* centraliza o conte√∫do do bot√£o (√≠cone + texto) */
    text-align: center;
  }
}
@media (max-width: 480px) {
  .hero-cta { flex-direction: column; }
  .hero-cta .btn { width: 100%; justify-content: center; }
  .hero h1 { font-size: 2rem; }
  .sec-title { font-size: 1.7rem; }
  .stat-num { font-size: 1.7rem; }
  .stats-inner { grid-template-columns: 1fr 1fr; }
  /* Make sure logo doesn't push ham off screen */
  .logo-name { font-size: .9rem; }
  .hdr-actions .btn-primary { display: none; }
}
</style>
</head>
<body>

<!-- MOBILE NAV OVERLAY -->
<div class="mobile-nav" id="mobile-nav" role="dialog" aria-modal="true" aria-label="Menu de navega√ß√£o">
  <button class="mobile-nav-close" id="nav-close" aria-label="Fechar menu">
    <i class="fas fa-times"></i>
  </button>
  <a href="#alertas" onclick="closeNav()">Alertas</a>
  <a href="#componentes" onclick="closeNav()">Sistema</a>
  <a href="#apoio" onclick="closeNav()">Apoio</a>
  <a href="#notificacoes" onclick="closeNav()">Notifica√ß√µes</a>
  <a href="/login" onclick="closeNav()" style="color:var(--t3);font-size:1rem;margin-top:4px"><i class="fas fa-lock" style="margin-right:8px"></i>Painel Admin</a>

  <!-- Accessibility inside mobile nav -->
  <div class="mobile-acc-section">
    <div class="mobile-acc-title">Acessibilidade</div>
    <button class="mob-acc-btn" id="mob-hc" onclick="toggleHC()"><i class="fas fa-adjust"></i> Alto Contraste</button>
    <button class="mob-acc-btn" id="mob-lm" onclick="toggleLM()"><i class="fas fa-sun"></i> Modo Claro</button>
    <button class="mob-acc-btn" id="mob-audio" onclick="toggleAudio()"><i class="fas fa-volume-up"></i> Ler P√°gina</button>
    <button class="mob-acc-btn" id="mob-font" onclick="toggleFont()"><i class="fas fa-text-height"></i> Aumentar Fonte</button>
    <button class="mob-acc-btn" id="mob-dys" onclick="toggleDys()"><i class="fas fa-font"></i> Fonte Dislexia</button>
  </div>
</div>

<!-- HEADER -->
<header id="hdr">
  <div class="hdr">
    <a href="#" class="logo" aria-label="{{ cfg.nome }} ‚Äî p√°gina inicial">
      <div class="logo-mark">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M12 2L20 6V12C20 16.4 16.4 20.4 12 22C7.6 20.4 4 16.4 4 12V6L12 2Z"/>
          <path d="M12 7V13" stroke="#0a0f1e" stroke-width="2.5" stroke-linecap="round" fill="none"/>
          <circle cx="12" cy="16" r="1.2" fill="#0a0f1e"/>
        </svg>
      </div>
      <div class="logo-text">
        <div class="logo-name">{{ cfg.nome }}</div>
        <div class="logo-sub">{{ cfg.subtitulo }}</div>
      </div>
    </a>

    <!-- Desktop nav -->
    <nav aria-label="Navega√ß√£o principal">
      <a href="#alertas">Alertas</a>
      <a href="#componentes">Sistema</a>
      <a href="#apoio">Apoio</a>
      <a href="#notificacoes">Notifica√ß√µes</a>

      <!-- Accessibility dropdown in nav -->
      <div style="position:relative">
        <button class="nav-acc-trigger" id="acc-trigger" aria-expanded="false" aria-haspopup="true" aria-controls="acc-dropdown">
          <i class="fas fa-universal-access"></i> Acessibilidade
          <i class="fas fa-chevron-down" style="font-size:.65rem"></i>
        </button>
        <div class="acc-dropdown" id="acc-dropdown" role="menu">
          <button class="acc-item" id="acc-hc" onclick="toggleHC()" role="menuitem"><i class="fas fa-adjust"></i> Alto Contraste</button>
          <button class="acc-item" id="acc-lm" onclick="toggleLM()" role="menuitem"><i class="fas fa-sun"></i> Modo Claro</button>
          <button class="acc-item" id="acc-audio" onclick="toggleAudio()" role="menuitem"><i class="fas fa-volume-up"></i> Ler P√°gina</button>
          <button class="acc-item" id="acc-font" onclick="toggleFont()" role="menuitem"><i class="fas fa-text-height"></i> Aumentar Fonte</button>
          <button class="acc-item" id="acc-dys" onclick="toggleDys()" role="menuitem"><i class="fas fa-font"></i> Fonte Dislexia</button>
        </div>
      </div>
    </nav>

    <div class="hdr-actions">
      <a href="/login" class="btn btn-ghost"><i class="fas fa-lock"></i> Admin</a>
      <a href="#apoio" class="btn btn-primary"><i class="fas fa-heart"></i> Apoiar</a>
      <button class="ham" id="ham" aria-label="Abrir menu" aria-expanded="false" aria-controls="mobile-nav">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </div>
</header>

<!-- TICKER -->
{% if alertas %}
<div class="ticker" role="marquee" aria-label="Alertas em destaque" style="margin-top:68px">
  <div class="ticker-track">
    {% for a in alertas %}
    <span class="t-item">
      <span class="t-sep"></span>
      <strong>{{ a['tipo']|upper }}</strong>&nbsp;‚Äî&nbsp;{{ a['titulo'] }}: {{ a['conteudo'][:60] }}‚Ä¶
    </span>
    {% endfor %}
    {% for a in alertas %}
    <span class="t-item">
      <span class="t-sep"></span>
      <strong>{{ a['tipo']|upper }}</strong>&nbsp;‚Äî&nbsp;{{ a['titulo'] }}: {{ a['conteudo'][:60] }}‚Ä¶
    </span>
    {% endfor %}
  </div>
</div>
{% else %}
<div style="margin-top:68px"></div>
{% endif %}

<main>
<!-- ===== HERO ===== -->
<section class="hero" id="inicio">
  <div class="hero-inner">
    <div>
      <div class="hero-badge" role="status">
        <span class="pulse-dot" aria-hidden="true"></span>
        Sistema Activo ‚Äî Nampula, Mo√ßambique
      </div>
      <h1>Protec√ß√£o Comunit√°ria</h1>
      <p class="hero-desc">
        O {{ cfg.nome }} integra meteorologia, seguran√ßa p√∫blica e sa√∫de num sistema unificado para proteger toda a popula√ß√£o da prov√≠ncia de Nampula.
      </p>
      <div class="hero-cta">
        <a href="#alertas" class="btn btn-primary"><i class="fas fa-bell" aria-hidden="true"></i> Ver Alertas Activos</a>
        <a href="#notificacoes" class="btn btn-teal"><i class="fas fa-satellite-dish" aria-hidden="true"></i> Activar Notifica√ß√µes</a>
      </div>
    </div>

    <div class="hero-right" aria-hidden="true">
      <div class="hero-card">
        <div class="hc-label"><i class="fas fa-gauge-high" style="color:var(--accent)"></i> Estado do Sistema</div>
        <div class="hc-grid">
          <div class="hc-metric">
            <div class="hc-icon" style="color:#f87171"><i class="fas fa-triangle-exclamation"></i></div>
            <div class="hc-num" id="stat-alertas">{{ stats.alertas }}</div>
            <div class="hc-txt">Alertas Activos</div>
          </div>
          <div class="hc-metric">
            <div class="hc-icon" style="color:var(--success)"><i class="fas fa-shield-halved"></i></div>
            <div class="hc-num">{{ stats.zonas }}</div>
            <div class="hc-txt">Zonas Seguras</div>
          </div>
          <div class="hc-metric">
            <div class="hc-icon" style="color:var(--accent)"><i class="fas fa-users"></i></div>
            <div class="hc-num">{{ stats.familias }}</div>
            <div class="hc-txt">Familias Registadas</div>
          </div>
          <div class="hc-metric">
            <div class="hc-icon" style="color:var(--warning)"><i class="fas fa-satellite-dish"></i></div>
            <div class="hc-num">{{ stats.subscricoes }}</div>
            <div class="hc-txt">Subscri√ß√µes</div>
          </div>
        </div>
        <div class="hc-status">
          <div class="hc-status-ico"><i class="fas fa-wifi"></i></div>
          <div>
            <div class="hc-status-label">Cobertura provincial</div>
            <div class="hc-status-val">4,35% activa</div>
          </div>
          <div class="status-pill">ONLINE</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===== STATS ===== -->
<div class="stats-bar" role="region" aria-label="Estat√≠sticas do sistema">
  <div class="stats-inner">
    <div class="stat-item">
      <div class="stat-num" data-target="{{ stats.alertas }}" id="stat-alertas-count">0</div>
      <div class="stat-label">Alertas Emitidos</div>
    </div>
    <div class="stat-item">
      <div class="stat-num" data-target="{{ stats.familias }}">0</div>
      <div class="stat-label">Familias Registadas</div>
    </div>
    <div class="stat-item">
      <div class="stat-num" data-target="{{ stats.zonas }}">0</div>
      <div class="stat-label">Zonas Seguras</div>
    </div>
    <div class="stat-item">
      <div class="stat-num" data-target="{{ stats.subscricoes }}">0</div>
      <div class="stat-label">Subscritores</div>
    </div>
  </div>
</div>

<!-- ===== ALERTS ===== -->
<section class="section" id="alertas">
  <div class="section-inner">
    <div class="section-head">
      <div class="sec-chip"><i class="fas fa-satellite-dish" aria-hidden="true"></i> Emerg√™ncias em Destaque</div>
      <h2 class="sec-title">Alertas Activos</h2>
      <p class="sec-desc">Informa√ß√µes actualizadas sobre situa√ß√µes de emerg√™ncia em tempo real na prov√≠ncia de Nampula.</p>
    </div>

    <div class="alerts-grid" id="alerts-grid" role="list">
      {% if alertas %}
        {% for a in alertas %}
        <article class="alert-card {{ a['tipo'] }}" role="listitem">
          <div class="alert-badge badge-{{ a['tipo'] }}" role="img" aria-label="Tipo: {{ a['tipo'] }}">
            <i class="fas fa-{% if a['tipo']=='urgente' %}circle-exclamation{% elif a['tipo']=='atencao' %}bell{% else %}circle-info{% endif %}" aria-hidden="true"></i>
            {{ a['tipo']|upper }}
          </div>
          <div class="alert-title">{{ a['titulo'] }}</div>
          <div class="alert-date">
            <i class="fas fa-calendar-days" aria-hidden="true"></i>
            <time>{{ fmt_datetime(a['data']) }}</time>
          </div>
          <div class="alert-text">{{ a['conteudo'] }}</div>
        </article>
        {% endfor %}
      {% else %}
      <div class="empty-state">
        <i class="fas fa-bell-slash" aria-hidden="true"></i>
        <p>Nenhum alerta activo no momento.</p>
      </div>
      {% endif %}
    </div>
  </div>
</section>

<!-- ===== COMPONENTS ===== -->
<section class="section" id="componentes">
  <div class="section-inner">
    <div class="section-head">
      <div class="sec-chip"><i class="fas fa-cubes" aria-hidden="true"></i> Arquitectura do Sistema</div>
      <h2 class="sec-title">Componentes Integrados</h2>
      <p class="sec-desc">Uma plataforma completa que une as principais fontes de informa√ß√£o para proteger Nampula.</p>
    </div>
    <div class="comp-grid">
      <div class="comp-card">
        <div class="comp-ico ico-b"><i class="fas fa-cloud-sun-rain" aria-hidden="true"></i></div>
        <div class="comp-title">Meteorologia &amp; Clima</div>
        <div class="comp-desc">Parceria com o INAM para previs√µes e alertas de fen√≥menos meteorol√≥gicos extremos em tempo real.</div>
      </div>
      <div class="comp-card">
        <div class="comp-ico ico-r"><i class="fas fa-shield-halved" aria-hidden="true"></i></div>
        <div class="comp-title">Protec√ß√£o Civil</div>
        <div class="comp-desc">Comunica√ß√£o directa com a Pol√≠cia, bombeiros e INGC para coordena√ß√£o de resposta de emerg√™ncia.</div>
      </div>
      <div class="comp-card">
        <div class="comp-ico ico-g"><i class="fas fa-heart-pulse" aria-hidden="true"></i></div>
        <div class="comp-title">Sa√∫de P√∫blica</div>
        <div class="comp-desc">Vigil√¢ncia epidemiol√≥gica, avisos de surtos e coordena√ß√£o com centros de sa√∫de provinciais.</div>
      </div>
      <div class="comp-card">
        <div class="comp-ico ico-a"><i class="fas fa-tower-broadcast" aria-hidden="true"></i></div>
        <div class="comp-title">Multicanal Digital</div>
        <div class="comp-desc">Web, WhatsApp, SMS e USSD garantem que os alertas chegam a toda a popula√ß√£o, com ou sem internet.</div>
      </div>
    </div>
  </div>
</section>

<!-- ===== APOIO ===== -->
<section class="section" id="apoio">
  <div class="section-inner">
    <div class="section-head">
      <div class="sec-chip"><i class="fas fa-hands-holding-circle" aria-hidden="true"></i> Solidariedade</div>
      <h2 class="sec-title">Apoio √† Comunidade</h2>
      <p class="sec-desc">Fam√≠lias afectadas, zonas de abrigo e como pode contribuir para quem mais precisa.</p>
    </div>
    <div class="apoio-layout">
      <!-- Families -->
      <div class="apoio-panel">
        <div class="panel-header">
          <div class="panel-ico pi-red"><i class="fas fa-house-chimney-crack" aria-hidden="true"></i></div>
          <div>
            <h3>Fam√≠lias Afectadas</h3>
            <div class="panel-count">{{ familias|length }} bairros registados</div>
          </div>
        </div>
        <div id="familias-container">   <!-- ‚Üê ID adicionado -->
          {% if familias %}
            {% for f in familias %}
            <div class="fam-row">
              <h4>{{ f['bairro'] }}</h4>
              <p><i class="fas fa-users" aria-hidden="true"></i> <strong style="color:var(--t1)">{{ f['numero'] }} fam√≠lias</strong> ‚Äî {{ f['situacao'] }}</p>
              <p><i class="fas fa-location-dot" aria-hidden="true"></i> {{ f['abrigo'] }}</p>
              <p><i class="fas fa-circle-exclamation" aria-hidden="true"></i> {{ f['necessidades'] }}</p>
            </div>
            {% endfor %}
          {% else %}
            <p style="color:var(--t3);font-size:.85rem;text-align:center;padding:20px">Nenhuma fam√≠lia registada.</p>
          {% endif %}
        </div>
      </div>

      <!-- Zones -->
      <div class="apoio-panel">
        <div class="panel-header">
          <div class="panel-ico pi-green"><i class="fas fa-shield-halved" aria-hidden="true"></i></div>
          <div>
            <h3>Zonas Seguras</h3>
            <div class="panel-count">{{ zonas|length }} locais dispon√≠veis</div>
          </div>
        </div>
        <div id="zonas-container">     <!-- ‚Üê ID adicionado -->
          {% if zonas %}
            {% for z in zonas %}
            <div class="zona-row">
              <div>
                <div class="zona-name">{{ z['nome'] }}</div>
                <div class="zona-res">{{ z['recursos'] }}</div>
              </div>
              <span class="zona-cap"><i class="fas fa-users" aria-hidden="true"></i> {{ z['capacidade'] }}</span>
            </div>
            {% endfor %}
          {% else %}
            <p style="color:var(--t3);font-size:.85rem;text-align:center;padding:20px">Nenhuma zona registada.</p>
          {% endif %}
        </div>
      </div>

      <!-- Support form -->
      <div class="apoio-panel">
        <div class="panel-header">
          <div class="panel-ico pi-blue"><i class="fas fa-hand-holding-heart" aria-hidden="true"></i></div>
          <div>
            <h3>Quero Ajudar</h3>
            <div class="panel-count">Registe o seu apoio aqui</div>
          </div>
        </div>
        <form class="form-grid" id="form-apoio" novalidate>
          <div class="fg">
            <label class="fl" for="tipo_apoio">Tipo de Apoio</label>
            <select name="tipo_apoio" id="tipo_apoio" class="fi" required>
              <option value="">Seleccione o tipo...</option>
              <option value="alimentos">üçö Alimentos n√£o perec√≠veis</option>
              <option value="agua">üíß √Ågua pot√°vel</option>
              <option value="higiene">üß¥ Kits de higiene</option>
              <option value="roupas">üëï Vestu√°rio e cobertores</option>
              <option value="medicamentos">üíä Medicamentos</option>
              <option value="financeiro">üí∞ Apoio financeiro</option>
              <option value="abrigo">üè† Abrigo tempor√°rio</option>
            </select>
          </div>
          <div class="fg">
            <label class="fl" for="quantidade">Quantidade / Descri√ß√£o</label>
            <input type="text" name="quantidade" id="quantidade" class="fi" placeholder="Ex: 10 sacos de arroz..." required>
          </div>
          <div class="fg">
            <label class="fl" for="local_entrega">Local de Entrega</label>
            <select name="local_entrega" id="local_entrega" class="fi" required>
              <option value="">Seleccione o local...</option>
              <option value="Escola Prim√°ria de Napipine">Escola Prim√°ria de Napipine</option>
              <option value="Centro Comunit√°rio Municipal">Conselho Municipal</option>
              <option value="Posto da Cruz Vermelha">Posto da Cruz Vermelha</option>
              <option value="Radio Encontro">Radio Encontro</option>
              <option value="Outro">Outro (especificar no contacto)</option>
            </select>
          </div>
         <div class="fg">
  <label class="fl" for="contacto_apoio">Seu Contacto</label>
  <div class="tel-wrapper">
    <input type="tel" name="contacto" id="contacto_apoio" class="fi tel-input"
           placeholder="87 000 0000" required
           pattern="[0-9]{9}" maxlength="9" inputmode="numeric"
           oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,9)">
  </div>
</div>
          <button type="submit" class="btn btn-teal btn-full" id="apoio-submit">
            <i class="fas fa-paper-plane" aria-hidden="true"></i> Enviar Apoio
          </button>
          <div class="form-ok" id="apoio-ok" role="alert"><i class="fas fa-circle-check" aria-hidden="true"></i> <span id="apoio-msg"></span></div>
          <div class="form-err" id="apoio-err" role="alert"><i class="fas fa-circle-xmark" aria-hidden="true"></i> <span id="apoio-err-msg"></span></div>
        </form>
      </div>
    </div>
  </div>
</section>

<!-- ===== NOTIFICATIONS ===== -->
<section class="section" id="notificacoes">
  <div class="section-inner">
    <div class="notif-layout">
      <!-- Left -->
      <div>
        <div class="sec-chip"><i class="fas fa-bell" aria-hidden="true"></i> Fique Informado</div>
        <h2 class="sec-title">Receba Alertas<br>Imediatamente</h2>
        <p class="sec-desc">Escolha como quer receber notifica√ß√µes. O servi√ßo √© gratuito e pode cancelar quando quiser.</p>
        <div class="notif-features">
          <div class="nf-row">
            <div class="nf-ico nf-wpp" aria-hidden="true"><i class="fab fa-whatsapp"></i></div>
            <div class="nf-text"><h4>WhatsApp</h4><p>Mensagens detalhadas com mapas e instru√ß√µes de seguran√ßa.</p></div>
          </div>
          <div class="nf-row">
            <div class="nf-ico nf-sms" aria-hidden="true"><i class="fas fa-message"></i></div>
            <div class="nf-text"><h4>SMS</h4><p>Alertas r√°pidos que chegam mesmo sem internet ou dados.</p></div>
          </div>
          <div class="nf-row">
            <div class="nf-ico nf-ussd" aria-hidden="true"><i class="fas fa-mobile-screen"></i></div>
            <div class="nf-text"><h4>USSD *140*1#</h4><p>Acesso a alertas activos a qualquer momento, sem internet.</p></div>
          </div>
          <div class="nf-row">
            <div class="nf-ico nf-free" aria-hidden="true"><i class="fas fa-gift"></i></div>
            <div class="nf-text"><h4>100% Gratuito</h4><p>Sem custos ocultos. Notifica√ß√µes financiadas pelo programa provincial.</p></div>
          </div>
        </div>
      </div>

      <!-- Right: form -->
<div>
  <div class="notif-card">
    <div class="notif-card-title">Activar Notifica√ß√µes</div>
    <div class="notif-card-sub">Preencha os seus dados e fique sempre informado sobre emerg√™ncias.</div>
    <form id="form-sub" style="display:flex; flex-direction:column; gap:16px" novalidate>

      <!-- Nome Completo -->
      <div class="fg">
        <label class="fl" for="sub-nome">Nome Completo</label>
        <input type="text" name="nome" id="sub-nome" class="fi" placeholder="O seu nome completo" required>
      </div>

      <!-- Dupla: Telem√≥vel e Email -->
      <div class="double-col">
        <!-- Telem√≥vel com prefixo +258 -->
        <div class="fg">
          <label class="fl" for="sub-tel">Telem√≥vel</label>
          <div class="tel-wrapper">
            <input type="tel" name="telefone" id="sub-tel" class="fi tel-input"
                   placeholder="87 000 0000" required
                   pattern="[0-9]{9}" maxlength="9" inputmode="numeric"
                   oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,9)">
          </div>
        </div>

        <!-- Email (opcional) -->
        <div class="fg">
          <label class="fl" for="sub-email">Email (opcional)</label>
          <input type="email" name="email" id="sub-email" class="fi" placeholder="email@exemplo.com">
        </div>
      </div> <!-- fecha double-col -->

      <!-- Canal de Notifica√ß√£o -->
      <div class="fg">
        <label class="fl">Canal de Notifica√ß√£o</label>
        <div class="channel-row">
          <label class="channel-pill wpp">
            <input type="checkbox" name="notificacoes[]" value="whatsapp" checked>
            <i class="fab fa-whatsapp" aria-hidden="true"></i> WhatsApp
          </label>
          <label class="channel-pill sms">
            <input type="checkbox" name="notificacoes[]" value="sms" checked>
            <i class="fas fa-message" aria-hidden="true"></i> SMS
          </label>
        </div>
      </div>

      <!-- Tipos de Alerta -->
      <div class="fg">
        <label class="fl">Tipos de Alerta</label>
        <div class="alert-chips">
          <label class="alert-chip"><input type="checkbox" name="tipo_alertas[]" value="urgentes" checked><i class="fas fa-triangle-exclamation" style="color:#f87171" aria-hidden="true"></i> Urgentes</label>
          <label class="alert-chip"><input type="checkbox" name="tipo_alertas[]" value="meteorologicos" checked><i class="fas fa-cloud-bolt" style="color:var(--warning)" aria-hidden="true"></i> Meteorol√≥gicos</label>
          <label class="alert-chip"><input type="checkbox" name="tipo_alertas[]" value="seguranca"><i class="fas fa-shield-halved" style="color:var(--accent)" aria-hidden="true"></i> Seguran√ßa</label>
          <label class="alert-chip"><input type="checkbox" name="tipo_alertas[]" value="saude"><i class="fas fa-heart-pulse" style="color:var(--success)" aria-hidden="true"></i> Sa√∫de</label>
          <label class="alert-chip"><input type="checkbox" name="tipo_alertas[]" value="inundacoes"><i class="fas fa-water" style="color:#60a5fa" aria-hidden="true"></i> Inunda√ß√µes</label>
          <label class="alert-chip"><input type="checkbox" name="tipo_alertas[]" value="ciclones"><i class="fas fa-wind" style="color:#a78bfa" aria-hidden="true"></i> Ciclones</label>
        </div>
      </div>

      <!-- Consentimento -->
      <label class="consent-row">
        <input type="checkbox" required>
        Concordo em receber notifica√ß√µes de emerg√™ncia do {{ cfg.nome }}
      </label>

      <!-- Bot√£o de submiss√£o -->
      <button type="submit" class="btn btn-primary btn-full" style="padding:14px; font-size:.92rem" id="sub-submit">
        <i class="fas fa-bell" aria-hidden="true"></i> Activar Notifica√ß√µes Gratuitas
      </button>

      <!-- Mensagens de feedback -->
      <div class="form-ok" id="sub-ok" role="alert"><i class="fas fa-circle-check" aria-hidden="true"></i> <span id="sub-msg"></span></div>
      <div class="form-err" id="sub-err" role="alert"><i class="fas fa-circle-xmark" aria-hidden="true"></i> <span id="sub-err-msg"></span></div>
    </form>

    <!-- Banner USSD -->
    <div class="ussd-banner" aria-label="Acesso sem internet via USSD">
      <div><div class="ussd-code">*140*1#</div></div>
      <p><strong>Sem internet?</strong> Marque o c√≥digo no seu telem√≥vel para aceder aos alertas activos a qualquer hora, gratuitamente.</p>
    </div>
  </div>
</div>
    </div>
  </div>
</section>
</main>

<!-- ===== FOOTER ===== -->
<footer>
  <div class="foot-inner">
    <div class="foot-grid">
      <div class="foot-brand-col">
        <a href="#" class="logo" aria-label="{{ cfg.nome }} ‚Äî in√≠cio">
          <div class="logo-mark">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M12 2L20 6V12C20 16.4 16.4 20.4 12 22C7.6 20.4 4 16.4 4 12V6L12 2Z"/>
              <path d="M12 7V13" stroke="#0a0f1e" stroke-width="2.5" stroke-linecap="round" fill="none"/>
              <circle cx="12" cy="16" r="1.2" fill="#0a0f1e"/>
            </svg>
          </div>
          <div class="logo-text">
            <div class="logo-name">{{ cfg.nome }}</div>
          </div>
        </a>
        <p class="foot-brand-desc">{{ cfg.subtitulo }}. Protegendo a comunidade de Nampula com tecnologia e solidariedade.</p>
        <div class="socials">
          {% if cfg.facebook %}<a href="{{ cfg.facebook }}" class="soc-btn" target="_blank" rel="noopener" aria-label="Facebook"><i class="fab fa-facebook-f" aria-hidden="true"></i></a>{% else %}<a href="#" class="soc-btn" aria-label="Facebook"><i class="fab fa-facebook-f" aria-hidden="true"></i></a>{% endif %}
          {% if cfg.twitter %}<a href="{{ cfg.twitter }}" class="soc-btn" target="_blank" rel="noopener" aria-label="Twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>{% else %}<a href="#" class="soc-btn" aria-label="Twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>{% endif %}
          {% if cfg.whatsapp %}<a href="https://wa.me/{{ cfg.whatsapp }}" class="soc-btn" target="_blank" rel="noopener" aria-label="WhatsApp"><i class="fab fa-whatsapp" aria-hidden="true"></i></a>{% else %}<a href="#" class="soc-btn" aria-label="WhatsApp"><i class="fab fa-whatsapp" aria-hidden="true"></i></a>{% endif %}
        </div>
      </div>
      <div class="foot-col">
        <h4>Navega√ß√£o</h4>
        <ul>
          <li><a href="#alertas"><i class="fas fa-chevron-right" aria-hidden="true"></i> Alertas Activos</a></li>
          <li><a href="#componentes"><i class="fas fa-chevron-right" aria-hidden="true"></i> Sistema</a></li>
          <li><a href="#apoio"><i class="fas fa-chevron-right" aria-hidden="true"></i> Apoio</a></li>
          <li><a href="#notificacoes"><i class="fas fa-chevron-right" aria-hidden="true"></i> Notifica√ß√µes</a></li>
        </ul>
      </div>
      <div class="foot-col">
        <h4>Contacto</h4>
        <ul>
          <li><i class="fas fa-envelope" aria-hidden="true"></i> {{ cfg.email }}</li>
          <li><i class="fas fa-phone" aria-hidden="true"></i> {{ cfg.telefone }}</li>
          <li style="align-items:flex-start"><i class="fas fa-location-dot" aria-hidden="true" style="margin-top:3px"></i> <span>{{ cfg.endereco }}</span></li>
        </ul>
      </div>
      <div class="foot-col">
        <h4>Links R√°pidos</h4>
        <ul>
          <li><a href="/login"><i class="fas fa-lock" aria-hidden="true"></i> Painel Admin</a></li>
          <li><a href="#apoio"><i class="fas fa-hands-helping" aria-hidden="true"></i> Fazer Donativo</a></li>
          <li><a href="#notificacoes"><i class="fas fa-bell" aria-hidden="true"></i> Subscrever Alertas</a></li>
          <li><a href="tel:119"><i class="fas fa-phone-emergency" aria-hidden="true"></i> Emerg√™ncia: 119</a></li>
        </ul>
      </div>
    </div>
    <div class="foot-divider"></div>
    <div class="foot-bottom">
      <p>¬© 2026 {{ cfg.nome }}. Todos os direitos reservados.</p>
      <div class="foot-verified" aria-label="Sistema verificado"><i class="fas fa-shield-halved" aria-hidden="true"></i> Sistema Seguro e Verificado</div>
      <p>Desenvolvido para Nampula üá≤üáø</p>
    </div>
  </div>
</footer>

<button class="btt" id="btt" aria-label="Voltar ao topo"><i class="fas fa-chevron-up" aria-hidden="true"></i></button>

<script>
/* ===== HEADER SCROLL ===== */
const hdr = document.getElementById('hdr');
const btt = document.getElementById('btt');
window.addEventListener('scroll', () => {
  hdr.classList.toggle('scrolled', window.scrollY > 40);
  btt.classList.toggle('show', window.scrollY > 400);
}, { passive: true });

/* ===== MOBILE NAV ===== */
const ham = document.getElementById('ham');
const mobileNav = document.getElementById('mobile-nav');
const navClose = document.getElementById('nav-close');

const hamIcon = ham.querySelector('i');
ham.onclick = () => {
  const open = mobileNav.classList.toggle('open');
  ham.setAttribute('aria-expanded', open);
  hamIcon.className = open ? 'fas fa-times' : 'fas fa-bars';
  document.body.style.overflow = open ? 'hidden' : '';
};
navClose.onclick = closeNav;
function closeNav() {
  mobileNav.classList.remove('open');
  ham.setAttribute('aria-expanded', 'false');
  hamIcon.className = 'fas fa-bars';
  document.body.style.overflow = '';
}
// Close on backdrop click
mobileNav.addEventListener('click', e => { if (e.target === mobileNav) closeNav(); });
// ESC key
document.addEventListener('keydown', e => { if (e.key === 'Escape') { closeNav(); accDropdown.classList.remove('open'); } });

/* ===== ACCESSIBILITY DROPDOWN ===== */
const accTrigger = document.getElementById('acc-trigger');
const accDropdown = document.getElementById('acc-dropdown');
accTrigger.onclick = (e) => {
  e.stopPropagation();
  const open = accDropdown.classList.toggle('open');
  accTrigger.setAttribute('aria-expanded', open);
};
document.addEventListener('click', e => {
  if (!accTrigger.contains(e.target) && !accDropdown.contains(e.target)) {
    accDropdown.classList.remove('open');
    accTrigger.setAttribute('aria-expanded', 'false');
  }
});

/* ===== COUNTER ANIMATION ===== */
const counters = document.querySelectorAll('.stat-num[data-target]');
const io = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (!entry.isIntersecting) return;
    const el = entry.target;
    const target = +el.dataset.target;
    let startTs = null;
    const animate = ts => {
      if (!startTs) startTs = ts;
      const p = Math.min((ts - startTs) / 1800, 1);
      const eased = p < 0.5 ? 2 * p * p : -1 + (4 - 2 * p) * p;
      el.textContent = Math.floor(eased * target).toLocaleString('pt-PT');
      if (p < 1) requestAnimationFrame(animate);
      else el.textContent = target.toLocaleString('pt-PT');
    };
    requestAnimationFrame(animate);
    io.unobserve(el);
  });
}, { threshold: 0.4 });
counters.forEach(c => io.observe(c));

/* ===== BACK TO TOP ===== */
btt.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });

/* ===== VALIDA√á√ÉO E ENVIO DOS FORMUL√ÅRIOS (SEM RECARREGAR) ===== */
function showMessage(elementId, message, isError = false) {
  const container = document.getElementById(elementId);
  const msgSpan = container.querySelector('span');
  msgSpan.textContent = message;
  container.classList.add('show');
  if (isError) {
    // Esconder mensagem de sucesso se estiver vis√≠vel
    const okId = elementId.replace('err', 'ok');
    const okEl = document.getElementById(okId);
    if (okEl) okEl.classList.remove('show');
  } else {
    const errId = elementId.replace('ok', 'err');
    const errEl = document.getElementById(errId);
    if (errEl) errEl.classList.remove('show');
  }
  // Auto-esconder ap√≥s 6 segundos
  setTimeout(() => container.classList.remove('show'), 6000);
}

// Formul√°rio de Apoio
document.getElementById('form-apoio').addEventListener('submit', async (e) => {
  e.preventDefault();
  const form = e.target;
  const tipo = document.getElementById('tipo_apoio').value;
  const quantidade = document.getElementById('quantidade').value.trim();
  const local = document.getElementById('local_entrega').value;
  let contacto = document.getElementById('contacto_apoio').value.trim();

  // Limpar mensagens anteriores
  document.getElementById('apoio-err').classList.remove('show');
  document.getElementById('apoio-ok').classList.remove('show');

  // Valida√ß√µes b√°sicas
  if (!tipo) {
    showMessage('apoio-err', 'Seleccione o tipo de apoio.', true);
    return;
  }
  if (!quantidade) {
    showMessage('apoio-err', 'Descreva a quantidade ou detalhes do apoio.', true);
    return;
  }
  if (!local) {
    showMessage('apoio-err', 'Seleccione o local de entrega.', true);
    return;
  }
  if (!contacto) {
    showMessage('apoio-err', 'Informe o seu contacto.', true);
    return;
  }

  // Valida√ß√£o do telefone (formato mo√ßambicano)
  contacto = contacto.replace(/\s+/g, ''); // remove espa√ßos
  if (!/^\d{9}$/.test(contacto)) {
    showMessage('apoio-err', 'O contacto deve ter exatamente 9 d√≠gitos.', true);
    return;
  }
  const prefix = contacto.substring(0, 2);
  const prefixosValidos = ['86', '87', '84', '85', '82', '83'];
  if (!prefixosValidos.includes(prefix)) {
    showMessage('apoio-err', 'O n√∫mero deve come√ßar com 86, 87, 84, 85, 82 ou 83.', true);
    return;
  }
  // Adicionar c√≥digo do pa√≠s
  contacto = '+258' + contacto;

  const btn = form.querySelector('button[type=submit]');
  const orig = btn.innerHTML;
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> A enviar‚Ä¶';
  btn.disabled = true;

  try {
    const formData = new FormData(form);
    // Substituir o campo contacto pelo valor completo com +258
    formData.set('contacto', contacto);

    const response = await fetch('/apoio', {
      method: 'POST',
      body: formData
    });
    const data = await response.json();

    if (data.ok) {
      showMessage('apoio-ok', data.msg || 'Apoio registado com sucesso! Obrigado.');
      form.reset();
      // Limpar o campo contacto (o reset n√£o limpa o input com valor fixo)
      document.getElementById('contacto_apoio').value = '';
    } else {
      showMessage('apoio-err', data.msg || 'Erro ao registar apoio.', true);
    }
  } catch (error) {
    showMessage('apoio-err', 'Erro de liga√ß√£o. Tente novamente.', true);
  } finally {
    btn.innerHTML = orig;
    btn.disabled = false;
  }
});

// Formul√°rio de Subscri√ß√£o (Notifica√ß√µes)
document.getElementById('form-sub').addEventListener('submit', async (e) => {
  e.preventDefault();
  const form = e.target;
  const nome = document.getElementById('sub-nome').value.trim();
  const telefoneInput = document.getElementById('sub-tel');
  let telefone = telefoneInput.value.trim().replace(/\s+/g, ''); // remove espa√ßos
  const email = document.getElementById('sub-email').value.trim();
  const canais = document.querySelectorAll('input[name="notificacoes[]"]:checked');
  const tipos = document.querySelectorAll('input[name="tipo_alertas[]"]:checked');
  const consentimento = document.querySelector('input[type="checkbox"]:required').checked;

  // Limpar mensagens
  document.getElementById('sub-err').classList.remove('show');
  document.getElementById('sub-ok').classList.remove('show');

  // Valida√ß√µes
  if (!nome) {
    showMessage('sub-err', 'Preencha o seu nome.', true);
    return;
  }

  // Valida√ß√£o do telefone
  if (!telefone) {
    showMessage('sub-err', 'Informe o n√∫mero de telem√≥vel.', true);
    return;
  }
  if (!/^\d{9}$/.test(telefone)) {
    showMessage('sub-err', 'O telem√≥vel deve ter exatamente 9 d√≠gitos.', true);
    return;
  }
  const prefix = telefone.substring(0, 2);
  const prefixosValidos = ['86', '87', '84', '85', '82', '83'];
  if (!prefixosValidos.includes(prefix)) {
    showMessage('sub-err', 'O n√∫mero deve come√ßar com 86, 87, 84, 85, 82 ou 83.', true);
    return;
  }
  // Adicionar o c√≥digo do pa√≠s
  telefone = '+258' + telefone;

  // Se email foi preenchido, valida√ß√£o simples
  if (email && !/^\S+@\S+\.\S+$/.test(email)) {
    showMessage('sub-err', 'E-mail inv√°lido.', true);
    return;
  }

  if (canais.length === 0) {
    showMessage('sub-err', 'Seleccione pelo menos um canal de notifica√ß√£o.', true);
    return;
  }
  if (tipos.length === 0) {
    showMessage('sub-err', 'Seleccione pelo menos um tipo de alerta.', true);
    return;
  }
  if (!consentimento) {
    showMessage('sub-err', '√â necess√°rio concordar com o consentimento.', true);
    return;
  }

  const btn = form.querySelector('button[type=submit]');
  const orig = btn.innerHTML;
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> A activar‚Ä¶';
  btn.disabled = true;

  try {
    // Criar FormData e substituir o telefone pelo valor completo
    const formData = new FormData(form);
    formData.set('telefone', telefone); // agora tem +258XXXX...

    const response = await fetch('/subscricao', {
      method: 'POST',
      body: formData
    });
    const data = await response.json();

    if (data.ok) {
      showMessage('sub-ok', data.msg || 'Notifica√ß√µes activadas com sucesso!');
      form.reset();
      // Limpar campo telefone (o reset n√£o limpa o input com valor fixo do span)
      telefoneInput.value = '';
    } else {
      showMessage('sub-err', data.msg || 'Erro ao activar notifica√ß√µes.', true);
    }
  } catch (error) {
    showMessage('sub-err', 'Erro de liga√ß√£o. Tente novamente.', true);
  } finally {
    btn.innerHTML = orig;
    btn.disabled = false;
  }
});

/* ===== NOVA FUN√á√ÉO: TEMPO REAL (POLLING) ===== */
function escapeHtml(unsafe) {
  return unsafe.replace(/[&<>"']/g, function(m) {
    if(m === '&') return '&amp;';
    if(m === '<') return '&lt;';
    if(m === '>') return '&gt;';
    if(m === '"') return '&quot;';
    if(m === "'") return '&#039;';
    return m;
  });
}

function atualizarInterface(dados) {
  // 1. Atualizar grelha de alertas
  const alertsGrid = document.getElementById('alerts-grid');
  if (alertsGrid) {
    if (dados.alertas.length === 0) {
      alertsGrid.innerHTML = '<div class="empty-state"><i class="fas fa-bell-slash" aria-hidden="true"></i><p>Nenhum alerta activo no momento.</p></div>';
    } else {
      alertsGrid.innerHTML = dados.alertas.map(a => `
        <article class="alert-card ${a.tipo}" role="listitem">
          <div class="alert-badge badge-${a.tipo}" role="img" aria-label="Tipo: ${a.tipo}">
            <i class="fas fa-${a.tipo === 'urgente' ? 'circle-exclamation' : (a.tipo === 'atencao' ? 'bell' : 'circle-info')}" aria-hidden="true"></i>
            ${a.tipo.toUpperCase()}
          </div>
          <div class="alert-title">${escapeHtml(a.titulo)}</div>
          <div class="alert-date">
            <i class="fas fa-calendar-days" aria-hidden="true"></i>
            <time>${new Date(a.data).toLocaleString('pt-PT', {day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit'})}</time>
          </div>
          <div class="alert-text">${escapeHtml(a.conteudo)}</div>
        </article>
      `).join('');
    }
  }

  // 2. Atualizar lista de fam√≠lias
  const familiasContainer = document.getElementById('familias-container');
  if (familiasContainer) {
    if (dados.familias.length === 0) {
      familiasContainer.innerHTML = '<p style="color:var(--t3);font-size:.85rem;text-align:center;padding:20px">Nenhuma fam√≠lia registada.</p>';
    } else {
      familiasContainer.innerHTML = dados.familias.map(f => `
        <div class="fam-row">
          <h4>${escapeHtml(f.bairro)}</h4>
          <p><i class="fas fa-users" aria-hidden="true"></i> <strong style="color:var(--t1)">${f.numero} fam√≠lias</strong> ‚Äî ${escapeHtml(f.situacao)}</p>
          <p><i class="fas fa-location-dot" aria-hidden="true"></i> ${escapeHtml(f.abrigo)}</p>
          <p><i class="fas fa-circle-exclamation" aria-hidden="true"></i> ${escapeHtml(f.necessidades)}</p>
        </div>
      `).join('');
    }
  }

  // 3. Atualizar lista de zonas
  const zonasContainer = document.getElementById('zonas-container');
  if (zonasContainer) {
    if (dados.zonas.length === 0) {
      zonasContainer.innerHTML = '<p style="color:var(--t3);font-size:.85rem;text-align:center;padding:20px">Nenhuma zona registada.</p>';
    } else {
      zonasContainer.innerHTML = dados.zonas.map(z => `
        <div class="zona-row">
          <div>
            <div class="zona-name">${escapeHtml(z.nome)}</div>
            <div class="zona-res">${escapeHtml(z.recursos)}</div>
          </div>
          <span class="zona-cap"><i class="fas fa-users" aria-hidden="true"></i> ${z.capacidade}</span>
        </div>
      `).join('');
    }
  }

  // 4. Atualizar n√∫meros das estat√≠sticas na stats-bar (usando data-target)
  document.querySelectorAll('.stat-num[data-target]').forEach(el => {
    const target = el.getAttribute('data-target');
    if (target === 'alertas') el.textContent = dados.stats.alertas.toLocaleString('pt-PT');
    else if (target === 'familias') el.textContent = dados.stats.familias.toLocaleString('pt-PT');
    else if (target === 'zonas') el.textContent = dados.stats.zonas.toLocaleString('pt-PT');
    else if (target === 'subscricoes') el.textContent = dados.stats.subscricoes.toLocaleString('pt-PT');
  });

  // 5. Atualizar ticker (se houver)
  const tickerTrack = document.querySelector('.ticker-track');
  if (tickerTrack) {
    if (dados.alertas.length > 0) {
      // Duplica os alertas para criar efeito cont√≠nuo
      const alertsDuplicated = [...dados.alertas, ...dados.alertas];
      tickerTrack.innerHTML = alertsDuplicated.map(a => `
        <span class="t-item">
          <span class="t-sep"></span>
          <strong>${a.tipo.toUpperCase()}</strong>&nbsp;‚Äî&nbsp;${escapeHtml(a.titulo)}: ${escapeHtml(a.conteudo.substring(0,60))}‚Ä¶
        </span>
      `).join('');
    } else {
      tickerTrack.innerHTML = ''; // esconde se n√£o houver alertas
    }
  }
}

function buscarDados() {
  fetch('/api/dados_publicos')
    .then(response => response.json())
    .then(data => atualizarInterface(data))
    .catch(err => console.error('Erro ao buscar dados:', err));
}

// Iniciar polling ap√≥s carregamento da p√°gina
document.addEventListener('DOMContentLoaded', function() {
  buscarDados(); // primeira execu√ß√£o imediata
  setInterval(buscarDados, 3000); // a cada 30 segundos
});

/* ===== ACCESSIBILITY FUNCTIONS ===== */
let fontSize = 16;
const synth = window.speechSynthesis;
let audioOn = false;

function setAccBtns(ids, on) {
  ids.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.toggle('on', on);
  });
}

function toggleHC() {
  const on = document.body.classList.toggle('hc');
  setAccBtns(['acc-hc', 'mob-hc'], on);
  try { localStorage.setItem('acc_hc', on ? '1' : '0'); } catch {}
}
function toggleLM() {
  const on = document.body.classList.toggle('light-mode');
  setAccBtns(['acc-lm', 'mob-lm'], on);
  try { localStorage.setItem('acc_lm', on ? '1' : '0'); } catch {}
}
function toggleAudio() {
  if (synth.speaking) {
    synth.cancel(); audioOn = false;
    setAccBtns(['acc-audio', 'mob-audio'], false);
    return;
  }
  const mainText = document.querySelector('main')?.innerText?.substring(0, 4000) || '';
  audioOn = true;
  setAccBtns(['acc-audio', 'mob-audio'], true);
  const u = new SpeechSynthesisUtterance(mainText);
  u.lang = 'pt-PT'; u.rate = 0.9;
  u.onend = () => { audioOn = false; setAccBtns(['acc-audio', 'mob-audio'], false); };
  synth.speak(u);
}
function toggleFont() {
  fontSize = fontSize >= 26 ? 14 : fontSize + 2;
  document.documentElement.style.setProperty('--fs', fontSize + 'px');
  document.documentElement.style.fontSize = fontSize + 'px';
  try { localStorage.setItem('acc_fs', fontSize); } catch {}
}
function toggleDys() {
  const isDys = document.body.style.fontFamily.includes('Comic');
  document.body.style.fontFamily = isDys ? '' : "'Comic Sans MS', cursive";
  setAccBtns(['acc-dys', 'mob-dys'], !isDys);
  try { localStorage.setItem('acc_dys', isDys ? '0' : '1'); } catch {}
}

/* Restore saved preferences */
(function applyPrefs() {
  try {
    if (localStorage.getItem('acc_hc') === '1') { document.body.classList.add('hc'); setAccBtns(['acc-hc','mob-hc'], true); }
    if (localStorage.getItem('acc_lm') === '1') { document.body.classList.add('light-mode'); setAccBtns(['acc-lm','mob-lm'], true); }
    if (localStorage.getItem('acc_dys') === '1') { document.body.style.fontFamily = "'Comic Sans MS', cursive"; setAccBtns(['acc-dys','mob-dys'], true); }
    const fs = localStorage.getItem('acc_fs');
    if (fs) { fontSize = +fs; document.documentElement.style.fontSize = fontSize + 'px'; }
  } catch {}
})();
</script>
</body>
</html>